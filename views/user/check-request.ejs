<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Check Request Status</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h2 class="mb-4">Your Waste Collection Requests</h2>

      <% if (requests && requests.length > 0) { %>
      <div class="row">
        <% requests.forEach(request => { %>
        <div class="col-md-6 mb-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">
                Request #<%= request._id.toString().slice(-6) %>
              </h5>

              <div class="mb-3">
                <strong>Status:</strong>
                <span
                  class="badge <%= request.status === 'Pending' ? 'bg-warning' : request.status === 'Approved' ? 'bg-success' : request.status === 'Rejected' ? 'bg-danger' : 'bg-secondary' %>"
                >
                  <%= request.status %>
                </span>
              </div>

              <div class="mb-2">
                <strong>Waste Types:</strong>
                <% request.wasteType.forEach(type => { %>
                <span class="badge bg-info me-1"><%= type %></span>
                <% }) %>
              </div>

              <div class="mb-2">
                <strong>Assigned Agency:</strong>
                <%= request.agency.name %>
              </div>

              <div class="mb-2">
                <strong>Submitted On:</strong>
                <%= request.createdAt.toLocaleDateString() %>
              </div>

              <div class="image-gallery mt-3">
                <strong>Uploaded Images:</strong>
                <div class="row mt-2">
                  <% request.wasteImages.forEach(image => { %>
                  <div class="col-4 mb-2">
                    <img
                      src="<%= image.url %>"
                      class="img-thumbnail"
                      alt="Waste Image"
                    />
                  </div>
                  <% }) %>
                </div>
              </div>
            </div>
          </div>
        </div>
        <% }) %>
      </div>
      <% } else { %>
      <div class="alert alert-info">
        <p>You haven't submitted any waste collection requests yet.</p>
        <a
          href="/user/<%= currentUser._id %>/apply-request"
          class="btn btn-primary"
        >
          Submit New Request
        </a>
      </div>
      <% } %>

      <div class="mt-4">
        <a
          href="/user/<%= currentUser._id %>/dashboard"
          class="btn btn-secondary"
        >
          Back to Dashboard
        </a>
        <% if (requests && requests.length > 0) { %>
        <a
          href="/user/<%= currentUser._id %>/apply-request"
          class="btn btn-primary"
        >
          Submit Another Request
        </a>
        <% } %>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
